<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiRefNet æ‰¹é‡æŠ å›¾</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .main-layout {
            display: flex;
            gap: 30px;
        }

        .left-panel {
            flex: 1;
            min-width: 0;
        }

        .right-panel {
            width: 350px;
            flex-shrink: 0;
        }

        @media (max-width: 1000px) {
            .main-layout {
                flex-direction: column;
            }
            .right-panel {
                width: 100%;
            }
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
            border-bottom: 2px solid #11998e;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #11998e;
        }

        .form-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .param-value {
            color: #11998e;
            font-weight: bold;
            margin-left: 8px;
        }

        .file-upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .file-upload-area:hover {
            border-color: #11998e;
            background: #f0fff4;
        }

        .file-upload-area.has-file {
            border-color: #28a745;
            background: #f0fff4;
        }

        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 8px;
            color: #2e7d32;
            font-size: 0.9rem;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress {
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 10px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #11998e;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .result-section {
            margin-top: 20px;
        }

        .result-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-image-item {
            border: 2px solid #eee;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .result-image-item img {
            width: 100%;
            display: block;
        }

        .result-image-item .image-info {
            padding: 10px;
            font-size: 0.85rem;
            color: #666;
            border-top: 1px solid #eee;
        }

        .result-info {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .result-info p {
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9rem;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: white;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .path-input-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            background: #fafafa;
            transition: all 0.3s;
        }

        .path-input-area:focus-within {
            border-color: #11998e;
            background: #f0fff4;
        }

        .path-hint {
            font-size: 0.8rem;
            color: #999;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="app">
        <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>

        <div class="header">
            <h1>ğŸ–¼ï¸ BiRefNet æ‰¹é‡æŠ å›¾å·¥å…·</h1>
            <p style="opacity: 0.9;">é«˜ç²¾åº¦AIæŠ å›¾ï¼Œæ”¯æŒå•å¼ å›¾ç‰‡ã€HTTPåœ°å€ã€å‹ç¼©åŒ…ä¸‰ç§è¾“å…¥æ¨¡å¼</p>
        </div>

        <div class="card">
            <div class="main-layout">
                <!-- å·¦ä¾§ï¼šè¾“å…¥é…ç½® -->
                <div class="left-panel">
                    <!-- è¾“å…¥æ¨¡å¼é€‰æ‹© -->
                    <div class="form-section">
                        <h3>ğŸ“ è¾“å…¥é…ç½®</h3>

                        <!-- æ¨¡å¼åˆ‡æ¢ -->
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" v-model="inputMode" value="image" style="width: 16px; height: 16px;">
                                <span>ğŸ“· å•å¼ å›¾ç‰‡</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" v-model="inputMode" value="urls" style="width: 16px; height: 16px;">
                                <span>ğŸ”— HTTPåœ°å€</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" v-model="inputMode" value="zip" style="width: 16px; height: 16px;">
                                <span>ğŸ“¦ å‹ç¼©æ–‡ä»¶</span>
                            </label>
                        </div>

                        <!-- å›¾ç‰‡ä¸Šä¼ æ¨¡å¼ -->
                        <div v-if="inputMode === 'image'">
                            <div
                                class="file-upload-area"
                                :class="{ 'has-file': imageFile }"
                                @click="triggerImageInput"
                                @dragover.prevent
                                @drop.prevent="handleImageDrop">
                                <div v-if="!imageFile">
                                    <p style="font-size: 1.1rem; color: #666; margin-bottom: 8px;">
                                        ğŸ“· ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡
                                    </p>
                                    <p style="font-size: 0.85rem; color: #999;">
                                        æ”¯æŒ jpg, png, webp ç­‰æ ¼å¼
                                    </p>
                                </div>
                                <div v-else class="file-info">
                                    âœ… {{ imageFile.name }} ({{ formatFileSize(imageFile.size) }})
                                </div>
                            </div>
                            <input
                                type="file"
                                ref="imageInput"
                                @change="handleImageSelect"
                                accept="image/*"
                                style="display: none;">
                        </div>

                        <!-- URLæ¨¡å¼ -->
                        <div v-if="inputMode === 'urls'" class="path-input-area">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>HTTPå›¾ç‰‡åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                                <textarea
                                    v-model="params.imageUrls"
                                    rows="6"
                                    placeholder="http://example.com/image1.jpg&#10;http://example.com/image2.jpg&#10;http://example.com/image3.jpg"
                                    style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 0.95rem; font-family: monospace; resize: vertical;"></textarea>
                                <p class="path-hint">
                                    æ¯è¡Œè¾“å…¥ä¸€ä¸ªå›¾ç‰‡URLåœ°å€ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†
                                </p>
                            </div>
                        </div>

                        <!-- ZIPæ¨¡å¼ -->
                        <div v-if="inputMode === 'zip'">
                            <div
                                class="file-upload-area"
                                :class="{ 'has-file': zipFile }"
                                @click="triggerZipInput"
                                @dragover.prevent
                                @drop.prevent="handleZipDrop">
                                <div v-if="!zipFile">
                                    <p style="font-size: 1.1rem; color: #666; margin-bottom: 8px;">
                                        ğŸ“¦ ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å‹ç¼©æ–‡ä»¶
                                    </p>
                                    <p style="font-size: 0.85rem; color: #999;">
                                        æ”¯æŒ .zip æ ¼å¼
                                    </p>
                                </div>
                                <div v-else class="file-info">
                                    âœ… {{ zipFile.name }} ({{ formatFileSize(zipFile.size) }})
                                </div>
                            </div>
                            <input
                                type="file"
                                ref="zipInput"
                                @change="handleZipSelect"
                                accept=".zip"
                                style="display: none;">
                        </div>
                    </div>

                    <!-- å›¾ç‰‡é¢„è§ˆ -->
                    <div class="form-section" v-if="previewImages.length > 0">
                        <h3>ğŸ‘ï¸ å›¾ç‰‡é¢„è§ˆ</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <div v-for="(preview, index) in previewImages" :key="index"
                                 style="width: 100px; height: 100px; border: 2px solid #ddd; border-radius: 8px; overflow: hidden; background: #f5f5f5;">
                                <img :src="preview" style="width: 100%; height: 100%; object-fit: cover;" :alt="'é¢„è§ˆå›¾ ' + (index + 1)">
                            </div>
                        </div>
                    </div>

                    <!-- è¾“å‡ºè®¾ç½® -->
                    <div class="form-section">
                        <h3>ğŸ“¥ è¾“å‡ºè®¾ç½®</h3>
                        <div class="form-group">
                            <label>æ–‡ä»¶åå‰ç¼€</label>
                            <input type="text" v-model="params.filenamePrefix" placeholder="%date:yyyy-MM-dd%/first-matting/img">
                            <p class="path-hint">
                                è¾“å‡ºæ–‡ä»¶å°†ä¿å­˜åˆ°ComfyUIçš„outputç›®å½•
                            </p>
                        </div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button
                            class="btn btn-primary"
                            @click="executeBatchMatting"
                            :disabled="!canExecute || processing">
                            {{ processing ? 'å¤„ç†ä¸­...' : 'ğŸš€ å¼€å§‹æ‰¹é‡æŠ å›¾' }}
                        </button>
                    </div>

                    <!-- è¿›åº¦æ˜¾ç¤º -->
                    <div v-if="processing" class="progress">
                        <div class="spinner"></div>
                        <p>{{ progressMessage }}</p>
                    </div>

                    <!-- é”™è¯¯æ˜¾ç¤º -->
                    <div v-if="errorMessage" class="error">
                        {{ errorMessage }}
                    </div>

                    <!-- ç»“æœæ˜¾ç¤º -->
                    <div v-if="result" class="result-section">
                        <h3 style="color: #28a745; font-size: 1.1rem;">âœ… æŠ å›¾å®Œæˆ</h3>
                        <div class="result-info" style="margin-bottom: 15px;">
                            <p><strong>å¤„ç†å›¾ç‰‡æ•°:</strong> {{ result.imageCount }}</p>
                            <p><strong>æ‰§è¡Œæ—¶é—´:</strong> {{ (result.executionTime / 1000).toFixed(1) }}ç§’</p>
                            <p style="margin-bottom: 0;"><strong>Prompt ID:</strong> {{ result.promptId }}</p>
                        </div>
                        <div style="margin-bottom: 15px; text-align: center;">
                            <button class="btn btn-primary" @click="downloadAllImages" style="padding: 8px 20px; font-size: 0.9rem;">
                                ğŸ“¥ æ‰¹é‡ä¸‹è½½å…¨éƒ¨å›¾ç‰‡
                            </button>
                        </div>
                        <div class="result-images" style="max-height: 500px; overflow-y: auto;">
                            <div v-for="(image, index) in result.images" :key="index" class="result-image-item">
                                <img :src="image.remoteUrl" :alt="image.filename">
                                <div class="image-info">
                                    {{ image.filename }}
                                    <div style="margin-top: 5px; display: flex; gap: 10px; justify-content: center;">
                                        <a :href="image.remoteUrl" target="_blank" style="color: #11998e; font-size: 0.75rem;">æŸ¥çœ‹åŸå›¾</a>
                                        <a href="javascript:void(0)" @click="downloadImage(image)" style="color: #28a745; font-size: 0.75rem;">ä¸‹è½½</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šæŠ å›¾å‚æ•° -->
                <div class="right-panel">
                    <!-- æ¨¡å‹é…ç½® -->
                    <div class="form-section">
                        <h3>ğŸ¤– æ¨¡å‹é…ç½®</h3>

                        <div class="form-group">
                            <label>BiRefNetæ¨¡å‹ç‰ˆæœ¬</label>
                            <select v-model="params.modelVersion">
                                <option value="BiRefNet-DIS5K">BiRefNet-DIS5K (æ¨è)</option>
                                <option value="BiRefNet-DIS5K_fp16">BiRefNet-DIS5K_fp16</option>
                                <option value="BiRefNet-general">BiRefNet-general</option>
                                <option value="BiRefNet-general-lite">BiRefNet-general-lite</option>
                                <option value="BiRefNet-portrait">BiRefNet-portrait</option>
                                <option value="BiRefNet-matting">BiRefNet-matting</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>è®¾å¤‡</label>
                            <select v-model="params.device">
                                <option value="auto">è‡ªåŠ¨</option>
                                <option value="cuda">CUDA (GPU)</option>
                                <option value="cpu">CPU</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" v-model="params.useRefine">
                                ä½¿ç”¨ç²¾ç»†åŒ–å¤„ç†
                            </label>
                        </div>
                    </div>

                    <!-- å›¾åƒå¤„ç† -->
                    <div class="form-section">
                        <h3>ğŸ¨ å›¾åƒå¤„ç†</h3>

                        <div class="form-group">
                            <label>å¤„ç†é«˜åº¦ <span class="param-value">{{ params.processHeight }}px</span></label>
                            <input type="range" v-model.number="params.processHeight" min="512" max="2048" step="64">
                        </div>

                        <div class="form-group">
                            <label>èƒŒæ™¯é¢œè‰²</label>
                            <select v-model="params.backgroundColor">
                                <option value="transparency">é€æ˜</option>
                                <option value="white">ç™½è‰²</option>
                                <option value="black">é»‘è‰²</option>
                                <option value="green">ç»¿è‰²</option>
                                <option value="blue">è“è‰²</option>
                                <option value="red">çº¢è‰²</option>
                            </select>
                        </div>
                    </div>

                    <!-- è’™ç‰ˆå¤„ç† -->
                    <div class="form-section">
                        <h3>âœ‚ï¸ è’™ç‰ˆå¤„ç†</h3>

                        <div class="form-group">
                            <label>è’™ç‰ˆæ‰©å±• <span class="param-value">{{ params.maskExpand }}px</span></label>
                            <input type="range" v-model.number="params.maskExpand" min="-20" max="20" step="1">
                            <p class="path-hint">è´Ÿå€¼æ”¶ç¼©è¾¹ç¼˜ï¼Œæ­£å€¼æ‰©å±•è¾¹ç¼˜</p>
                        </div>

                        <div class="form-group">
                            <label>æ¨¡ç³ŠåŠå¾„ <span class="param-value">{{ params.blurRadius }}px</span></label>
                            <input type="range" v-model.number="params.blurRadius" min="0" max="20" step="0.5">
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" v-model="params.taperedCorners">
                                é”¥å½¢è¾¹è§’
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" v-model="params.fillHoles">
                                å¡«å……å­”æ´
                            </label>
                        </div>
                    </div>

                    <!-- æ”¾å¤§é…ç½® -->
                    <div class="form-section">
                        <h3>ğŸ” æ”¾å¤§é…ç½®</h3>

                        <div class="form-group">
                            <label>æ”¾å¤§æ¨¡å‹</label>
                            <select v-model="params.upscaleModel">
                                <option value="4x-UltraSharp.pth">4x-UltraSharp (æ¨è)</option>
                                <option value="4x_NMKD-Siax_200k.pth">4x_NMKD-Siax</option>
                                <option value="RealESRGAN_x4plus.pth">RealESRGAN_x4plus</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; color: white; margin-top: 30px; opacity: 0.8;">
            <p>Powered by Vue 3 + Spring Boot + ComfyUI + BiRefNet</p>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    inputMode: 'image',
                    imageFile: null,
                    zipFile: null,
                    previewImages: [],  // é¢„è§ˆå›¾ç‰‡æ•°ç»„
                    processing: false,
                    progressMessage: '',
                    errorMessage: null,
                    result: null,
                    params: {
                        // è¾“å…¥é…ç½®
                        imageUrls: '',

                        // æ¨¡å‹é…ç½®
                        modelVersion: 'BiRefNet-DIS5K',
                        device: 'auto',
                        useRefine: true,

                        // å›¾åƒå¤„ç†
                        processHeight: 1024,
                        backgroundColor: 'transparency',

                        // è’™ç‰ˆå¤„ç†
                        maskExpand: 5,
                        blurRadius: 1.5,
                        taperedCorners: true,
                        fillHoles: false,
                        lerpAlpha: 1.0,
                        decayFactor: 1.0,

                        // æ”¾å¤§é…ç½®
                        upscaleModel: '4x-UltraSharp.pth',

                        // è¾“å‡ºé…ç½®
                        filenamePrefix: '%date:yyyy-MM-dd%/first-matting/img'
                    }
                };
            },
            computed: {
                canExecute() {
                    if (this.inputMode === 'image') {
                        return this.imageFile !== null;
                    } else if (this.inputMode === 'urls') {
                        return this.params.imageUrls && this.params.imageUrls.trim();
                    } else if (this.inputMode === 'zip') {
                        return this.zipFile !== null;
                    }
                    return false;
                }
            },
            watch: {
                'params.imageUrls'(newUrls) {
                    if (this.inputMode === 'urls' && newUrls) {
                        this.updateUrlPreviews(newUrls);
                    }
                },
                inputMode(newMode) {
                    // åˆ‡æ¢æ¨¡å¼æ—¶æ¸…ç©ºé¢„è§ˆ
                    this.previewImages = [];
                }
            },
            methods: {
                triggerImageInput() {
                    this.$refs.imageInput.click();
                },
                handleImageSelect(event) {
                    const file = event.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        this.imageFile = file;
                        this.result = null;
                        this.errorMessage = null;
                        this.generateImagePreview(file);
                    }
                },
                handleImageDrop(event) {
                    const file = event.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        this.imageFile = file;
                        this.result = null;
                        this.errorMessage = null;
                        this.generateImagePreview(file);
                    }
                },
                generateImagePreview(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.previewImages = [e.target.result];
                    };
                    reader.readAsDataURL(file);
                },
                triggerZipInput() {
                    this.$refs.zipInput.click();
                },
                handleZipSelect(event) {
                    const file = event.target.files[0];
                    if (file && file.name.endsWith('.zip')) {
                        this.zipFile = file;
                        this.result = null;
                        this.errorMessage = null;
                    }
                },
                handleZipDrop(event) {
                    const file = event.dataTransfer.files[0];
                    if (file && file.name.endsWith('.zip')) {
                        this.zipFile = file;
                        this.result = null;
                        this.errorMessage = null;
                    }
                },
                formatFileSize(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
                },
                updateUrlPreviews(urlText) {
                    // è§£æURLåˆ—è¡¨
                    const urls = urlText.split('\n')
                        .map(url => url.trim())
                        .filter(url => url && (url.startsWith('http://') || url.startsWith('https://')));

                    // åªä¿ç•™å‰10ä¸ªURLçš„é¢„è§ˆï¼Œé¿å…å¤ªå¤š
                    this.previewImages = urls.slice(0, 10);
                },
                async downloadImage(image) {
                    try {
                        // å°è¯•é€šè¿‡åç«¯ä»£ç†ä¸‹è½½
                        const proxyUrl = `/api/matting/download?url=${encodeURIComponent(image.remoteUrl)}&filename=${encodeURIComponent(image.filename)}`;

                        const a = document.createElement('a');
                        a.href = proxyUrl;
                        a.download = image.filename;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    } catch (error) {
                        console.error('ä¸‹è½½å›¾ç‰‡å¤±è´¥:', error);
                        alert('ä¸‹è½½å¤±è´¥: ' + error.message);
                    }
                },
                async downloadAllImages() {
                    if (!this.result || !this.result.images || this.result.images.length === 0) {
                        alert('æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡');
                        return;
                    }

                    // æ‰¹é‡ä¸‹è½½ï¼ˆé€šè¿‡åç«¯ä»£ç†ï¼Œæ— éœ€å»¶è¿Ÿï¼‰
                    for (let i = 0; i < this.result.images.length; i++) {
                        const image = this.result.images[i];
                        try {
                            this.downloadImage(image);
                            // å°å»¶è¿Ÿé¿å…æµè§ˆå™¨åŒæ—¶è§¦å‘å¤ªå¤šä¸‹è½½
                            await new Promise(resolve => setTimeout(resolve, 100));
                        } catch (error) {
                            console.error(`ä¸‹è½½ç¬¬ ${i + 1} å¼ å›¾ç‰‡å¤±è´¥:`, error);
                        }
                    }
                },
                async executeBatchMatting() {
                    // éªŒè¯è¾“å…¥
                    if (!this.canExecute) {
                        this.errorMessage = 'è¯·å…ˆå®Œæˆè¾“å…¥é…ç½®';
                        return;
                    }

                    this.processing = true;
                    this.errorMessage = null;
                    this.result = null;
                    this.progressMessage = 'æ­£åœ¨åŠ è½½æ¨¡å‹å’Œå¤„ç†å›¾ç‰‡...';

                    try {
                        const formData = new FormData();

                        // è¾“å…¥æ¨¡å¼
                        formData.append('inputMode', this.inputMode);

                        // æ ¹æ®æ¨¡å¼æ·»åŠ ä¸åŒçš„è¾“å…¥å‚æ•°
                        if (this.inputMode === 'image') {
                            formData.append('imageFile', this.imageFile);
                        } else if (this.inputMode === 'urls') {
                            formData.append('imageUrls', this.params.imageUrls.trim());
                        } else if (this.inputMode === 'zip') {
                            formData.append('zipFile', this.zipFile);
                        }

                        // æ¨¡å‹é…ç½®
                        formData.append('modelVersion', this.params.modelVersion);
                        formData.append('device', this.params.device);
                        formData.append('useRefine', this.params.useRefine);

                        // å›¾åƒå¤„ç†
                        formData.append('processHeight', this.params.processHeight);
                        formData.append('backgroundColor', this.params.backgroundColor);

                        // è’™ç‰ˆå¤„ç†
                        formData.append('maskExpand', this.params.maskExpand);
                        formData.append('blurRadius', this.params.blurRadius);
                        formData.append('taperedCorners', this.params.taperedCorners);
                        formData.append('fillHoles', this.params.fillHoles);
                        formData.append('lerpAlpha', this.params.lerpAlpha);
                        formData.append('decayFactor', this.params.decayFactor);

                        // æ”¾å¤§é…ç½®
                        formData.append('upscaleModel', this.params.upscaleModel);

                        // è¾“å‡ºé…ç½®
                        formData.append('filenamePrefix', this.params.filenamePrefix);

                        this.progressMessage = 'æ­£åœ¨æ‰§è¡Œæ‰¹é‡æŠ å›¾ï¼Œè¯·è€å¿ƒç­‰å¾…...';

                        const response = await axios.post('/api/matting/batch', formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });

                        if (response.data.code === 200) {
                            this.result = response.data.data;
                            this.progressMessage = 'æŠ å›¾å®Œæˆï¼';
                        } else {
                            this.errorMessage = response.data.message || 'æŠ å›¾å¤±è´¥';
                        }
                    } catch (error) {
                        console.error('æ‰¹é‡æŠ å›¾å¤±è´¥:', error);
                        this.errorMessage = error.response?.data?.message || error.message || 'ç½‘ç»œé”™è¯¯';
                    } finally {
                        this.processing = false;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
